<!DOCTYPE html>
<html>
<head>
    <title>Image Gallery</title>
    <!-- Add your CSS and JavaScript links here if needed -->
    <style>
        .container {
            text-align: left;
        }
        .img-thumbnail {
            border: 1px solid; /* Add a simple 2px solid border */
            margin: 8px; /* Optional: Add some margin around the image */
        }
        .comment-content {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <h1>Image Gallery</h1>
    <hr>

    <div class="container">
        <!-- upload form -->
        <form action="" method="post" enctype="multipart/form-data">
            {% csrf_token %}
            {{ form.as_p }}
            <button type="submit" class="btn btn-lg btn-success">Upload</button>
        </form>
        <hr>

        {% if obj %}
            <script>
                // Save the current scroll position
                var scrollPosition = window.scrollY;

                // Redirect to the new URL
                window.location.href = "";

                // After the redirect, restore the scroll position
                window.onload = function() {
                    window.scrollTo(0, scrollPosition);
                };
            </script>
        {% endif %}
        
        {% for x in img %}
            <h4 class="text-center">@exampleUsername: {{ x.title }}</h4>
            <a href="{% url 'image_detail' x.id %}">
                <img src="{{ x.image.url }}" height="20%" width="20%" class="img-thumbnail" alt="{{ x.title }}">
            </a>
            <span class="post-date" style="font-size: 1em; float: right;">Post created on {{ x.date_posted }}</span>
            <p class="text-center">Description: {{ x.description }}</p>

            <!-- Display Comments -->
            <ul>
                {% for comment in x.comments.all %}
                    <li class="comment-content">
                        <span class="comment-username" style="font-weight: bold; margin-right: 10px;">@User{{ comment.user.username }}:</span>
                        {{ comment.text }}
                        <span class="comment-date" style="font-size: 0.8em; float: right;">Commented on {{ comment.date_commented }}</span>

                        <form method="post" action="{% url 'delete_Imagecomment' x.id comment.id %}" style="display: inline;">
                            {% csrf_token %}
                            <button type="submit" style="background: none; border: none; color: red; cursor: pointer;">Delete</button>
                        </form>
                    </li>
                {% endfor %}
            </ul>
            <!-- Comment Form -->
            <form method="post" action="{% url 'add_Imagecomment' x.id %}">
                {% csrf_token %}
                <input type="text" name="comment_text" placeholder="Add a comment">
                <button type="submit">Comment</button>
            </form>

            <form method="post" action="{% url 'delete_image' x.id %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-lg btn-danger">Delete Image</button>
            </form>
            <hr>
        {% endfor %}
    </div>
    
    {% if forloop.first %}
    <div class="row">
    {% endif %}
    
    <div class="col-lg-4 col-md-4 col-12">
        <div class="text-center mt-2">
            <!-- Add content here -->
        </div>
    </div>
</body>
</html>
